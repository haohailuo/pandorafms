<?xml version="1.0" encoding="utf-8"?> 

<chapter id="chapter8">
  <title>Database Maintenance</title>
  
  <para>
    The core of Pandora's system is its Database. All the data
    collected by the monitored	machines is stored in this data base,
    from the administrator's data, to the events, incidents and audit
    data generated in the system at any time.
  </para>

  <para>
    It is obvious that the efficiency and reliability of this
    module is vital for the correct functioning of Pandora.
    A regular data base maintenance is needed. To do so the data base
    managers can use standard MySQL commands. Maintaining Pandora database
    in good condition is critital for Pandora to work properly.
  </para>
  
  <para>
    As the database size will increase linearly, the data will be
    compacted to reduce the amount of stored data without loosing 
    important information, specially the different graphs that are 
    generated with the processed data.
  </para>
  <para>
    Going to "DB Maintenance" from the Administration menu we will
    find the Database configuration defined in the "Pandora Setup" option
    of the Administration menu to compact and delete data.
  </para>
  <graphic scale='70' fileref="images/image054.png" valign="bottom" 
	   align="center"/>
  <sect1 id="sec8.1">
    <title>DB Information</title>
    <para>
      The DB statistics are generated by Agent, on the 
      "DB Maintenance" &gt; "DB Information" in the Administration menu,
      and are represented in two kinds of graphs:
    </para>
    <itemizedlist>
      <listitem>
	<para>
	 Number of modules configured for each of the agents.
 	</para>
      </listitem>
      <listitem>
	<para>
	 Number of packages sent by each agent. A package is the group 
	 of data linked to the module the agent sends in each interval of 
	 time.
 	</para>
      </listitem>
    </itemizedlist>
    <graphic scale='70' fileref="images/image055.png" valign="bottom" 
	     align="center"/>
    <graphic scale='70' fileref="images/image056.png" valign="bottom" 
	     align="center"/>
    <graphic scale='70' fileref="images/image057.png" valign="bottom" 
	     align="center"/>
    <para>
     These graphs can be also viewed from 
     "View Agents" &gt; "Statistics" in the Operation menu.
    </para>
    <para>
     It is possible to view the Data Base information in text mode 
	 pressing "Press here to get DB Info as text" 
    </para>
    <graphic scale='70' fileref="images/DBText.png" valign="bottom" 
	     align="center"/>
  </sect1>
  <sect1 id="sec8.2">
    <title>Manual purge of the Datadase</title>
    <para>
     Pandora counts with powerful tools for the Administrator to manually
     purge the majority of data stored in the Database. This includes data
     generated by both the agents and the server by its own.
    </para>
    <sect2 id="sec8.2.1">
    <title>Agent's data purge</title>
     <sect3 id="sec8.2.1.1">
      <title>Debuging selected data from a module</title>
      <para>
	The option of purging selected data from a module is used
	to eliminate those out of range entries, whatever the reason
	- agent failure, out of range values, testing, DB errors, etc.
	Eliminating erroneous, incorrect or unnecessary data makes 
	the graphical representation more acuarate and shows the data
	without peaks or unreal scales.
      </para>
      <para>
	From "DB Maintenance" &gt; "Database Debug" in the
	Administration menu any of the out of range data received
	from a agent's module can be deleted.
      </para>
      <graphic scale='70' fileref="images/image058.png" valign="bottom" 
	       align="center"/>
      <para>
       The purge settings are: agent, module, minimum and maximum data
       range. Any parameter out of this minimum/maximum range will be 
       deleted.
      </para>
      <para>
	For example, in a module registering the number of processes,
	if we are only interested in values between 0 and 100, any values 
	above that number will be usually produced by errors, noise 
	or abnormal circumstances. If we set to range between 0 and 100 
	all those values below and above - such as -1, 100 or 100000 - 
	will be permanently deleted from the database.
      </para>
     </sect3>
     <sect3 id="sec8.2.1.2">
      <title>Purging all the agent's data</title>
      <para>
	All the out of range data received by an agent can be deleted
	from the "DB Maintenance" &gt; "Database Purge" option in the
	Administration menu.
      </para>
      <para>
	The data is deleted by the following parameters from 
	the "Delete data" screen:
      </para>
      <itemizedlist>
	<listitem>
	  <para>
	   Purge all data
   	  </para>
	</listitem>
	<listitem>
	  <para>
	   Purge data over 90 days
   	  </para>
	</listitem>
	<listitem>
	  <para>
	   Purge data over 30 days
   	  </para>
	</listitem>
	<listitem>
	  <para>
	   Purge data over 14 days
 	  </para>
	</listitem>
	<listitem>
	  <para>
	   Purge data over 7 days
   	  </para>
	</listitem>
	<listitem>
	  <para>
	   Purge data over 3 days
   	  </para>
	</listitem>
	<listitem>
	  <para>
	   Purge data over 1 day
   	  </para>
	</listitem>
      </itemizedlist>
      <graphic scale='70' fileref="images/image059.png" valign="bottom" 
		align="center"/>
    </sect3>
   </sect2>
   <sect2 id="sec8.2.2">
    <title>Purging system data</title>
    <sect3 id="sec8.2.2.1">
      <title>Audit data purge</title>
      <para>
	All the audit data generated by the system can be deleted from 
	"DB Maintenance" &gt; "Database Audit", in the Administration
	menu
      </para>
      <para>
	The data to be deleted is selected by setting the following
	parameters in the "Delete Data" screen
      </para>
      <itemizedlist>
	<listitem>
	  <para>
	   Purge audit data over 90 days
   	  </para>
	</listitem>
	<listitem>
	  <para>
	   Purge audit data over 30 days
  	  </para>
	</listitem>
	<listitem>
	  <para>
	   Purge audit data over 14 days
  	  </para>
	</listitem>
	<listitem>
	  <para>
	   Purge audit data over 7 days
  	  </para>
	</listitem>
	<listitem>
	  <para>
	   Purge audit data over 3 days
  	  </para>
	</listitem>
	<listitem>
	  <para>
	   Purge audit data over 1 day
          </para>
	</listitem>
	<listitem>
	  <para>
	   Purge all audit data
   	  </para>
	</listitem>
      </itemizedlist>
      <graphic scale='70' fileref="images/image060.png" valign="bottom" 
	       align="center"/>
    </sect3>
    <sect3 id="sec8.2.2.2">
      <title>Event data purge</title>
      <para>
	All the event data generated by the system can be deleted from 
	"DB Maintenance" &gt; "Database Event", in the Administration menu
      </para>
      <para>
	The data to be deleted is selected by setting the following 
	parameters in the "Delete Data" screen
      </para>
      <itemizedlist>
	<listitem>
	  <para>
	   Purge event data over 90 days
          </para>
	</listitem>
	<listitem>
	  <para>
	   Purge event data over 30 days
   	   </para>
	</listitem>
	<listitem>
	  <para>
           Purge event data over 14 days
          </para>
	</listitem>
	<listitem>
	  <para>
	   Purge event data over 7 days
          </para>
	</listitem>
	<listitem>
	  <para>
	   Purge event data over 3 days
   	  </para>
	</listitem>
	<listitem>
	  <para>
	   Purge event data over 1 day
   	  </para>
	</listitem>
	<listitem>
	  <para>
	   Purge all event data
   	  </para>
	</listitem>
      </itemizedlist>
      <graphic scale='70' fileref="images/image061.png" valign="bottom" 
	       align="center"/>
    </sect3>
   </sect2>
  </sect1>
</chapter>
