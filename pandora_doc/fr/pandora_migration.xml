<?xml version="1.0" encoding="utf-8"?>
<chapter>
  <title>Migration depuis Pandora 1.1</title>
  <sect1><title>Migrer Pandora 1.1 vers Pandora 1.2</title>
  <para>
    Vous aurez besoin du script pandoradb_1.1_to_1.2.sql fourni
    avec la console Pandora version 1.2. Migrer de la version 1.1
    à la version 1.2 inclus:
    <itemizedlist mark='bullet'>
      <listitem>
	<para>
	  Le remplacement complet du code PHP de la console Pandora
          (sauvegardez votre original pour remplacer les valeurs dans
          /include/config.php pour votre login, mot de passe, nom d'hôte,
          et les paramètres de la base de données.
	</para>
      </listitem>
      <listitem>
	<para>
	  Le remplacement complet du code PERL du serveur (sauvegardez 
          votre original pour remplacer les valeurs dans pandora_server.conf.
          Le nouveau pandora_server.conf est situé dans le répertoire /conf.
          Il est possible que vous aillez besoin de changer le répertoire de
          réception des données et les paramètres dans les scripts du démon.
          (lire la documentation de Pandora Serveur 1.2 avant d'essayer de le
          démarrer).
	</para>
      </listitem>
      <listitem>
	<para>
	  Lisez la documentation au sujet des nouvelles fonctionnalités
          de Pandora 1.2. Le processus de migration ne supprime aucune
          donnée, aucun agent, ni configuration, ni données d'environnement,
          mais veuillez tout de même, s'il vous plaît, lire _attentivement_
          toute la documentation sur le sujet avant d'essayer.
	</para>
      </listitem>
    </itemizedlist>
  </para>
  </sect1>
  <sect1><title>Etapes de la Migration </title>
  <para>
    0. Stoppez le service Serveur Pandora avant de changer quoi que ce soit
    dans la base de données. Notez que vous ne perdrez aucune donnée pendant le
    processus de migration puisque les données des agents seront stockées
    dans le répertoire de réception des données. Déplacez ce répertoire vers
    le nouveau répertoire de réception avant de démarrer le nouveau serveur,
    et Pandora traitera les données sans perte.
  </para>
  <para>
    1. Faites un DUMP de tous les enregistrements tagente_datos vers un lieu sûr, par exemple:
    <programlisting>
      mysqldump --no-create-info -u root -p pandora \
                tagente_datos > /tmp/pandora.conv.tmp
    </programlisting>
  </para>
  <para>
    2. Exécutez le script SQL de migration, par exemple:
    <programlisting>
      cat pandoradb_1.1_to_1.2.sql | mysql -u root -p -D pandora
    </programlisting>
    
    NOTEZ que ce script va supprimer (drop) vos tables de données, NE RATEZ PAS
    l'étape 1.
  </para>
  <para>
    3. Réinportez les données sauvées au cours de la première étape, par exemple:
    <programlisting>
      cat /tmp/pandora.conv.tmp | mysql -u root -p -D pandora
    </programlisting>
  </para>
  <para>
    4. Supprimez les fichiers temporaires, par exemple:
    <programlisting>
      rm -Rf /tmp/pandora.conv.tmp
    </programlisting>
  </para>
  </sect1>
  <sect1><title>Mise à jour du code</title>
  <para>
    Sauvegardez simplement vos installations Pandora Console et Pandora Serveur
    et procédez comme pour une nouvelle installation de Pandora. Utilisez vos
    paramètres de configuration existants pour cette nouvelle installation de
    Pandora. La migration de la base de données est l'étape la plus critique et
    doit être réalisée avant d'utiliser le nouveau code.
  </para>
  </sect1>
  <sect1><title>Etape finale</title>
  <para>
    Démarrez les nouveaux composants Pandora. Ouvrez la console Web et
    vérifiez qu'un nouveau "Network Server" a été créé. Editez chaque
    agent pour lui attribuer ce nouveau serveur. Cette étape peut être
    automatisée en utilisant SQL, et dne doit être effectuée qu'une fois.
    Cela n'a besoin d'être fait que si vous voulez utiliser Network Servers.
  </para>
  </sect1>
</chapter>
